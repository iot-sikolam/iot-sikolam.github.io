<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    SIKOLAM
  </title>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/argon-dashboard.css?v=2.1.0" rel="stylesheet" />
</head>

<body class="g-sidenav-show   bg-gray-100">
  <aside
    class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4 "
    id="sidenav-main">
    <div class="sidenav-header">
      <i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
        aria-hidden="true" id="iconSidenav"></i>
      <a class="navbar-brand m-0" href="../pages/dashboard.html">
        <img src="../assets/img/logo-ct-dark.png" width="26px" height="26px" class="navbar-brand-img h-100"
          alt="main_logo">
        <span class="ms-1 font-weight-bold">SIKOLAM</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse  w-auto " id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="../pages/dashboard.html">
            <div
              class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-tv-2 text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">Account pages</h6>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="../pages/profile.html">
            <div
              class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-single-02 text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link " href="../index.html">
            <div
              class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-collection text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Sign Out</span>
          </a>
        </li>
      </ul>
    </div>
    <div class="sidenav-footer mx-3 pt-9">
      <div class="copyright text-center text-sm text-muted text-lg-start">
        Â©
        <script>
          document.write(new Date().getFullYear())
        </script>,
        </i> Bayu Septiana Aziz
        <a href="" class="font-weight-bold" target="_blank">UNIGAL Sistem Informasi</a>
      </div>
    </div>
  </aside>
  <main class="main-content position-relative border-radius-lg ">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl " id="navbarBlur"
      data-scroll="false">
      <div class="container-fluid py-4 px-0">
        <nav aria-label="breadcrumb">
          <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
            <ul class="navbar-nav">
              <li class="nav-item d-xl-none ps-3 mx-3 align-items-center">
                <a href="javascript:;" class="nav-link text-white p-0" id="iconNavbarSidenav">
                  <div class="sidenav-toggler-inner">
                    <i class="sidenav-toggler-line bg-dark"></i>
                    <i class="sidenav-toggler-line bg-dark"></i>
                    <i class="sidenav-toggler-line bg-dark"></i>
                  </div>
                </a>
              </li>
            </ul>
            <h6 class="font-weight-bolder text-dark mb-0">Profile</h6>
          </div>
        </nav>
      </div>
    </nav>
    <!-- End Navbar -->
    <div class="card shadow-lg mx-3 card-profile">
      <div class="card-body p-3">
        <div class="row gx-4">
          <div class="avatar position-relative" style="width: 100px; height: 100px;">
            <img id="profile-image" src="" alt="profile_image" class="object-fit-cover"
              style="width: 100%; height: 100%;">
          </div>
          <div class="col-auto my-auto">
            <h5 id="profile-name" class="mb-1"></h5>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid py-4">
      <div class="card">
        <div class="card-header pb-0">
          <div class="d-flex align-items-center">
            <p class="text-uppercase text-sm">User Information</p>
            <button class="btn btn-success btn-sm ms-auto" data-bs-toggle="modal"
              data-bs-target="#editModal">Edit</button>
          </div>
        </div>
        <div class="card-body">
          <p><strong>Username:</strong> <span id="profile-username"></span></p>
          <p><strong>Email:</strong> <span id="profile-email"></span></p>
          <p><strong>Name:</strong> <span id="profile-name"></span></p>
          <p><strong>About me:</strong> <span id="profile-about"></span></p>
        </div>
      </div>
    </div>

    <!-- Modal for Editing -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">Edit Profile</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <div class="mb-3">
                  <label class="form-label">Profile Picture</label>
                  <input type="file" id="edit-avatar" class="form-control">
              </div>
              <div class="mb-3">
                  <label class="form-label">Username</label>
                  <input type="text" id="edit-username" class="form-control">
              </div>
              <div class="mb-3">
                  <label class="form-label">Email</label>
                  <input type="email" id="edit-email" class="form-control">
              </div>
              <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input type="text" id="edit-name" class="form-control">
              </div>
              <div class="mb-3">
                  <label class="form-label">About me</label>
                  <textarea id="edit-about" class="form-control"></textarea>
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="saveChanges">Save changes</button>
          </div>
      </div>
  </div>
</div>

    <!--   Core JS Files   -->
    <script src="../assets/js/core/popper.min.js"></script>
    <script src="../assets/js/core/bootstrap.min.js"></script>
    <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script>
      var win = navigator.platform.indexOf('Win') > -1;
      if (win && document.querySelector('#sidenav-scrollbar')) {
        var options = {
          damping: '0.5'
        }
        Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
      }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="../assets/js/argon-dashboard.min.js?v=2.1.0"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Konfigurasi Firebase
        const firebaseConfig = {
      apiKey: "AIzaSyB6vrF4kzhKKqvKuOhfm1sHp3p4Q5bzovo",
      authDomain: "sikolam-iot.firebaseapp.com",
      projectId: "sikolam-iot",
      storageBucket: "sikolam-iot.firebasestorage.app",
      messagingSenderId: "856061496746",
      appId: "1:856061496746:web:fd0100ba08e9e90e69efd3",
      measurementId: "G-DG3PWBWYTT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    async function loadProfile() {
        const docRef = doc(db, "users", "profile");
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
            let data = docSnap.data();
            document.getElementById("profile-image").src = data.avatar;
            document.getElementById("profile-name").innerText = data.name;
            document.getElementById("profile-username").innerText = data.username;
            document.getElementById("profile-email").innerText = data.email;
            document.getElementById("profile-about").innerText = data.about;
        } else {
            console.log("No profile data found!");
        }
    }

    async function saveProfile() {
        let file = document.getElementById("edit-avatar").files[0];
        let imageUrl = document.getElementById("profile-image").src;

        if (file) {
            const storageRef = ref(storage, "/assets/img/" + file.name);
            await uploadBytes(storageRef, file);
            imageUrl = await getDownloadURL(storageRef);
        }

        let updatedData = {
            username: document.getElementById("edit-username").value,
            email: document.getElementById("edit-email").value,
            name: document.getElementById("edit-name").value,
            about: document.getElementById("edit-about").value,
            avatar: imageUrl
        };

        await setDoc(doc(db, "users", "profile"), updatedData);
        alert("Profile updated successfully!");
        loadProfile();
    }

    document.addEventListener("DOMContentLoaded", loadProfile);

    document.querySelector("#saveChanges").addEventListener("click", saveProfile);

    document.querySelector('[data-bs-target="#editModal"]').addEventListener("click", function () {
        document.getElementById("edit-username").value = document.getElementById("profile-username").innerText;
        document.getElementById("edit-email").value = document.getElementById("profile-email").innerText;
        document.getElementById("edit-name").value = document.getElementById("profile-name").innerText;
        document.getElementById("edit-about").value = document.getElementById("profile-about").innerText;
    });
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>